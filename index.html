<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Tralendar</title>
    <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="style/style.css">
    <link rel="stylesheet" href="style/calendar.css">
  </head>
  <body>
    <div class="container">
      <div id="datepicker"></div>
      <button class="btn btn-default btn-lg btn-main" onclick="moreDates()">Show more dates</button>
    </div> <!-- /container -->

    <!-- Placed at the end of the document so the pages load faster -->
    <script src="bower_components/d3/d3.min.js" charset="utf-8"></script>
    <script src="bower_components/moment/min/moment-with-langs.js" charset="utf-8"></script>
    <script src="src/tralendar.js" charset="utf-8"></script>
    <script>

      var trips = [
        { frm: "Bilbao", to: "Donostia", dep: "2014-07-15 8:30", arr: "2014-07-15 10:30", extra: "dd" },
        { frm: "Bilbao", to: "Donostia", dep: "2014-07-15 10:30", arr: "2014-07-15 11:30", extra: "" },
        { frm: "Bilbao", to: "Donostia", dep: "2014-07-15 12:30", arr: "2014-07-15 13:30", extra: "" },
        { frm: "Bilbao", to: "Donostia", dep: "2014-07-15 14:30", arr: "2014-07-15 15:30", extra: "" },
        { frm: "Bilbao", to: "Donostia", dep: "2014-07-15 17:30", arr: "2014-07-15 19:15", extra: "" },
        { frm: "Bilbao", to: "Gasteiz", dep: "2014-07-15 11:30", arr: "2014-07-15 12:25", extra: "" },
        { frm: "Bilbao", to: "Gasteiz", dep: "2014-07-15 13:30", arr: "2014-07-15 13:32", extra: "" },
        { frm: "Bilbao", to: "Gasteiz", dep: "2014-07-15 14:30", arr: "2014-07-15 15:30", extra: "" },
        { frm: "Bilbao", to: "Gasteiz", dep: "2014-07-15 21:30", arr: "2014-07-15 22:35", extra: "" },
        { frm: "Bilbao", to: "Donostia", dep: "2014-07-16 8:30", arr: "2014-07-16 10:30", extra: "" }, // ----
        { frm: "Bilbao", to: "Donostia", dep: "2014-07-16 10:30", arr: "2014-07-16 11:30", extra: "" },
        { frm: "Bilbao", to: "Donostia", dep: "2014-07-16 12:30", arr: "2014-07-16 13:30", extra: "" },
        { frm: "Bilbao", to: "Donostia", dep: "2014-07-16 14:30", arr: "2014-07-16 15:30", extra: "" },
        { frm: "Bilbao", to: "Donostia", dep: "2014-07-16 17:30", arr: "2014-07-16 19:15", extra: "" },
        { frm: "Bilbao", to: "Gasteiz", dep: "2014-07-16 11:30", arr: "2014-07-16 12:25", extra: "" },
        { frm: "Bilbao", to: "Gasteiz", dep: "2014-07-16 13:30", arr: "2014-07-16 13:32", extra: "" },
        { frm: "Bilbao", to: "Gasteiz", dep: "2014-07-16 14:30", arr: "2014-07-16 15:30", extra: "" },
        { frm: "Bilbao", to: "Gasteiz", dep: "2014-07-16 21:30", arr: "2014-07-16 22:35", extra: "" },
        { frm: "Bilbao", to: "Donostia", dep: "2014-07-18 8:30", arr: "2014-07-18 10:30", extra: "" }, // ----
        { frm: "Bilbao", to: "Donostia", dep: "2014-07-18 10:30", arr: "2014-07-18 11:30", extra: "" },
        { frm: "Bilbao", to: "Donostia", dep: "2014-07-18 12:30", arr: "2014-07-18 13:30", extra: "" },
        { frm: "Bilbao", to: "Donostia", dep: "2014-07-18 14:30", arr: "2014-07-18 15:30", extra: "" },
        { frm: "Bilbao", to: "Donostia", dep: "2014-07-18 17:30", arr: "2014-07-18 19:15", extra: "" },
        { frm: "Bilbao", to: "Gasteiz", dep: "2014-07-18 11:30", arr: "2014-07-18 12:25", extra: "" },
        { frm: "Bilbao", to: "Gasteiz", dep: "2014-07-18 13:30", arr: "2014-07-18 13:32", extra: "" },
        { frm: "Bilbao", to: "Gasteiz", dep: "2014-07-18 14:30", arr: "2014-07-18 15:30", extra: "" },
        { frm: "Bilbao", to: "Gasteiz", dep: "2014-07-18 21:30", arr: "2014-07-18 22:35", extra: "" },
        { frm: "Bilbao", to: "Donostia", dep: "2014-07-19 8:30", arr: "2014-07-19 10:30", extra: "" }, // ----
        { frm: "Bilbao", to: "Donostia", dep: "2014-07-19 10:30", arr: "2014-07-19 11:30", extra: "" },
        { frm: "Bilbao", to: "Donostia", dep: "2014-07-19 12:30", arr: "2014-07-19 13:30", extra: "" },
        { frm: "Bilbao", to: "Donostia", dep: "2014-07-19 14:30", arr: "2014-07-19 15:30", extra: "" },
        { frm: "Bilbao", to: "Donostia", dep: "2014-07-19 17:30", arr: "2014-07-19 19:15", extra: "" },
        { frm: "Bilbao", to: "Gasteiz", dep: "2014-07-19 11:30", arr: "2014-07-19 12:25", extra: "" },
        { frm: "Bilbao", to: "Gasteiz", dep: "2014-07-19 13:30", arr: "2014-07-19 13:32", extra: "" },
        { frm: "Bilbao", to: "Gasteiz", dep: "2014-07-19 14:30", arr: "2014-07-19 15:30", extra: "" },
        { frm: "Bilbao", to: "Gasteiz", dep: "2014-07-19 21:30", arr: "2014-07-19 22:35", extra: "" },
        { frm: "Bilbao", to: "Donostia", dep: "2014-07-22 14:30", arr: "2014-07-22 15:30", extra: "" },  
      ]


      moment.lang('eu')

      var span = 35

      var tralendar = d3.tralendar()
          .starts(moment('2014-07-15', 'YYYY-MM-DD'))
          .span(span) // Number of days
          .clickCallback(dayClicked)
          .mouseoverCallback(dayMouseover)
          .mouseoutCallback(dayMouseout)

      var days = d3.nest()
          .key(function(d) { return d.date })
          .map(trips.map(function(_) {
            return { date: moment(_.dep, 'YYYY-MM-DD H:mm').format('YYYY-MM-DD'), extra: _.extra }
          }), d3.map)

      d3.select("#datepicker")
            .datum(days)
            .call(tralendar)

      function dayMouseover(_) {
        console.log('mouseover', moment(_.moment).format('YYYY-MM-DD'))
      }

      function dayMouseout(_) {
        console.log('mouseout', moment(_.moment).format('YYYY-MM-DD'))
      }

      function dayClicked(_) {
        console.log('clicked', moment(_.moment).format('YYYY-MM-DD'))
      }

      function moreDates() {
        span += 30
        tralendar.span(span)
        d3.select("#datepicker").datum(days).call(tralendar)
      }

    </script>
  </body>
</html>