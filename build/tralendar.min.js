/*
tralendar 0.0.1- A calendar generator in D3, suitable to do date picking or date range picking
https://github.com/hanbzu/tralendar.git
Built on 2014-12-03
*/
if("undefined"==typeof d3)throw new Error("missing d3");d3.tralendar=function(){function a(a){return moment.max(moment(a).startOf("week"),moment(a).startOf("month"))}function b(){function a(){var a=moment(e.start).add(e.days,"days").endOf("month").endOf("day");return a.diff(e.start,"days")+1}return d3.range(0,a()).map(function(a){return moment(e.start).add(a,"days")})}function c(a,b){function c(a){var b=moment(a[0].moment),c=moment(b).weekday(0);return b!=c?d3.range(b.diff(c,"days")).map(function(){return{isBlank:!0}}).concat(a):a}function d(a){var c=moment(a).format("YYYY-MM-DD"),d=b.has(c);return{hasEvent:d,yearmonth:a.format("YYYY-MM"),moment:a,extra:d?b.get(c)[0].extra:"",chosen:d?b.get(c)[0].chosen:!1}}return d3.nest().key(function(a){return a.yearmonth}).sortKeys(d3.ascending).rollup(c).entries(a.map(d))}var d,e={start:a(moment().startOf("day")),days:35,mouseoverCallback:function(a){console.log("mouseover callback",a)},mouseoutCallback:function(a){console.log("mouseout callback",a)},clickCallback:function(a){console.log("click callback",a)}},f=function(a){a.each(function(a){function f(a){var b=d3.select(this).select("ol").selectAll("li").data(a.values);b.enter().append("li").each(g),b.exit().remove()}function g(a){var b=d3.select(this);b.classed("blank",a.isBlank),a.isBlank||(b.classed("disabled",!a.hasEvent).text(moment(a.moment).format("D")),a.hasEvent&&(b.classed("chosen",a.chosen),b.on("mouseover",function(a){e.mouseoverCallback(a)}),b.on("mouseout",function(a){e.mouseoutCallback(a)}),b.on("click",function(a){var b=d3.select(this);b.classed("chosen",!b.classed("chosen")),e.clickCallback(a)})))}var h=b(),i=c(h,a);d||(d=d3.select(this).append("ol").classed("calendar",!0));var j=d.selectAll("li").data(i,function(a){return a.key}),k=j.enter().append("li").classed("month",!0);k.append("h1").classed("monthname",!0).text(function(a){return moment(a.key,"YYYY-MM").format("MMMM")}),k.append("ol").classed("daygrid",!0),j.exit().remove(),j.each(f)})};return f.starts=function(b){return arguments.length?(e.start=a(moment(b,"YYYY-MM-DD")),this):e.start.format("YYYY-MM-DD")},f.span=function(a){return arguments.length?(e.days=a,this):e.days},f.clickCallback=function(a){return e.clickCallback=a,this},f.mouseoverCallback=function(a){return e.mouseoverCallback=a,this},f.mouseoutCallback=function(a){return e.mouseoutCallback=a,this},f.test={calendar:function(){return b(e.start,e.days)},extendedCalendar:function(a,b){return c(a,b)}},f},function(){var a,b,c,d,e,f,g,h,i=[].slice;e=42,f=!0,f&&(e=-42),h=function(a){return a*a},b=[1,2,3,4,5],c={root:Math.sqrt,square:h,cube:function(a){return a*h(a)}},g=function(){var a,b;return b=arguments[0],a=2<=arguments.length?i.call(arguments,1):[],print(b,a)},"undefined"!=typeof elvis&&null!==elvis&&alert("I knew it!"),a=function(){var a,e,f;for(f=[],a=0,e=b.length;e>a;a++)d=b[a],f.push(c.cube(d));return f}()}.call(this);